# Steam Game Unlocker

这是一个Steam游戏解锁工具，可以帮助您管理和解锁Steam游戏。该工具通过Git仓库获取游戏的清单文件和密钥，并使用SteamTools或GreenLuma来实现游戏解锁。

![应用程序截图](screenshot.png)

## 功能特点

- 友好的图形用户界面，简单易用
- 从Git仓库分支名称中提取AppID
- 显示游戏列表，并标记已解锁状态
- 本地存储游戏信息，避免重复加载
- 从SteamDB获取游戏名称的功能
- 查看已解锁游戏状态的功能
- 右键菜单支持解锁/取消解锁操作
- 支持SteamTools和GreenLuma两种解锁方式
- 自动配置和复制所需的清单文件
- 支持批量解锁功能：可通过Git Worktree自动处理多个游戏解锁
- **新增配置对话框**：首次使用时自动提示配置必要路径
- **新增打包功能**：支持打包成单个EXE文件便于分发

## 架构设计

应用程序采用MVC（模型-视图-控制器）架构，确保流畅的用户体验：

1. **前后端分离**：UI和数据处理完全分离，所有耗时操作都在独立线程中执行
2. **被动数据加载**：应用程序启动时不自动加载数据，由用户主动触发
3. **进度反馈**：所有耗时操作都提供清晰的进度反馈
4. **本地数据持久化**：使用JSON文件存储游戏信息，减少重复加载
5. **异步验证**：游戏解锁状态在后台异步验证，不影响UI响应
6. **自动配置**：首次启动时自动检测配置并提示用户进行设置

## 安装与使用

### 方法1：使用打包好的EXE文件

1. 下载最新的发布版本（Release）中的EXE文件
2. 双击运行EXE文件
3. 首次运行时，按照提示配置Steam路径和清单仓库路径
4. 开始使用应用程序管理和解锁游戏

### 方法2：从源码运行

1. 确保您已安装Python 3.7或更高版本
2. 确保您的系统已安装Git
3. 下载或克隆此仓库
4. 安装依赖：
   ```
   pip install -r requirements.txt
   ```
5. 运行应用程序：
   ```
   python app.py
   ```
   或使用提供的启动脚本：
   - Windows: 双击 `start.bat`
   - Linux/Mac: 执行 `./start.sh`

### 方法3：自行打包EXE文件

1. 安装所需依赖：
   ```
   pip install -r requirements.txt
   ```
2. 运行打包脚本：
   ```
   python build.py
   ```
3. 打包完成后，在`dist`目录中找到可执行文件

## 使用说明

### 首次使用

1. 首次运行时，应用程序会自动弹出配置对话框
2. 您需要设置以下路径：
   - **Steam路径**：Steam安装目录（例如：`C:/Program Files (x86)/Steam`）
   - **清单仓库路径**：包含游戏清单文件的Git仓库路径

### 基本功能

1. **刷新显示**：刷新游戏列表的显示
2. **检查解锁状态**：检查所有游戏的解锁状态
3. **获取游戏名称**：从SteamDB获取游戏的真实名称
4. **更新列表**：从Git仓库获取最新分支信息，更新游戏列表
5. **搜索功能**：通过AppID或游戏名称快速搜索游戏

### 右键菜单功能

右键点击列表中的游戏可以执行以下操作：
- **解锁游戏**：执行游戏解锁操作
- **取消解锁**：移除游戏的解锁状态
- **复制AppID**：复制游戏的AppID到剪贴板
- **打开Steam页面**：在浏览器中打开游戏的Steam商店页面

### 批量解锁（命令行）

使用`batch_unlock.py`脚本提供批量解锁功能：

```
python batch_unlock.py --repo /path/to/git/repository --steam D:/Steam
```

## 解锁方法

该工具支持两种主要解锁流程：

1. **标准解锁流程**:
   - 处理清单文件夹以提取密钥和清单信息
   - 复制清单文件到Steam的depotcache目录
   - 使用提取的数据配置SteamTools或GreenLuma

2. **直接lua解锁流程**:
   - 从存储库中复制预先准备好的AppID.lua文件
   - 复制所有清单文件到depotcache目录
   - 使用SteamTools的luapacka.exe编译lua文件

系统会根据是否存在AppID.lua文件自动选择合适的解锁方法。

## 清单仓库格式

清单仓库应包含以下文件：
- `*.manifest`文件：游戏的清单文件，文件名格式为`[DEPOT_ID]_[MANIFEST_ID].manifest`
- `key.vdf`文件：包含depot ID和解密密钥
- `[AppID].lua`文件（可选）：预配置的SteamTools lua脚本

仓库的分支名称应包含游戏的AppID，例如`origin/12345-gamename`，其中`12345`是AppID。

## 数据存储

应用程序会在本地保存以下数据文件：

1. **games_data.json**：存储游戏信息
2. **branch_cache.json**：存储分支信息和处理进度
3. **config.json**：存储用户配置

## 配置问题解决

如果配置出现问题，您可以：

1. 通过菜单"文件 > 设置"打开配置对话框
2. 重新设置Steam路径和清单仓库路径
3. 如果配置文件损坏，应用程序会自动创建新的配置文件

## 打包说明

详细的打包说明可以参考项目中的`打包说明.md`文件，包括：
- 如何使用`build.py`脚本进行打包
- 打包过程中的注意事项
- 常见问题解决方法

## 隐私保护

为保护用户隐私，本项目已配置`.gitignore`文件，以排除以下内容：

- 个人配置文件（如config.json）
- 缓存数据（如branch_cache.json, games_data.json）
- 包含个人信息的清单和密钥文件
- 临时文件和备份
- Python编译缓存文件
- IDE相关配置文件
- 打包生成的文件夹（dist/, build/）

## 注意事项

- 使用本工具可能违反Steam服务条款
- 仅用于个人学习和研究目的
- 作者不对使用本工具导致的任何问题负责
- 不要分享包含个人标识信息的配置文件

## 贡献

欢迎提交Issue和Pull Request来改进此工具。

## 许可

本项目基于MIT许可证开源。